import os
import math

malware_path = 'E:/머신러닝/train_malware'
benign_path = 'E:/머신러닝/train_benign'

save_path = 'E:/머신러닝/toy_fixed_mal'
byte_dict = dict()

total = 0
count = 0

goal_dict = dict()
for root, dirs, files in os.walk(malware_path):
    for filename in files:
        md5, ext = os.path.splitext(filename)
        if ext == '.vir':
            with open(os.path.join(root, filename), 'rb') as f:
                byte_dict[md5] = bytearray(f.read())
            count += 1
            print(count)


for md5 in byte_dict:
    file_size = len(byte_dict[md5])
    goal = pow(32, 2)
    chunk_size = file_size - goal + 1
    goal_dict[md5] = list()
    if file_size > goal:
        for idx in range(goal):
            goal_dict[md5].append(sum(byte_dict[md5][idx:idx + chunk_size + 1]) / chunk_size)
            print(idx)
    else:
        goal_dict[md5] = byte_dict[md5]
        while (len(goal_dict[md5]) != goal):
            goal_dict[md5].append(0)


for md5 in goal_dict:
    with open(os.path.join(save_path, md5 + '.vir'), 'wb') as f:
        f.write(goal_dict[md5])